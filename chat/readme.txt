計算機システム構成原理1演習 第3回レポート課題 15TI023 池崎雄介

[ファイルの説明]
server.c	: ネットワークを介して、順番を問わずにテキストデータのやりとりができるサーバ・クライアントのサーバプログラム
server		: server.cの実行形式ファイル
client.c	: ネットワークを介して、順番を問わずにテキストデータのやりとりができるサーバ・クライアントのクライアントプログラム
client		: client.cの実行形式ファイル
readme.txt	: このファイル

[実行手順]
・サーバ側
コンパイル	: gcc server.c -o server
実行		: ./server ポート番号
・クライアント側
コンパイル	: gcc client.c -o client
実行		: ./client IPアドレス ポート番号

[工夫した点]
・子プロセスの終了判定で、waitpid(-1, NULL, WNOHANG)とすることで、いずれかの子プロセスが終了したときに親プロセスがwhile文を抜け、子プロセスをkillで終了させている。
・プロセスの複製の際、for文で1行で書いている。このようにすると、プロセスをforkしたとき、複製されたプロセスは次の行から実行するため、子プロセスをfor文のループ分だけ生成できる。

[考察]
・テキスト入力の際、>>> を表示しようと思ったが、printfでは表示できないという問題に陥った(putsなら表示できたが、>>> の後に改行をすることになるため却下した)。この原因は、送信側のfgetsが動いていて、改行されるまで入力を受け付けているためではないかと考えた。しかし、putsをして改行をした後にprintfをやっても表示されず、再度、putsをすると、その時一緒にprintfの内容が出力されるという現象が起こった。この問題はまだ解決していないので、引き続き調べる必要がある。
・サーバまたはクライアントでquitすると、まれに、どちらかの受信がもう一方から空メッセージを複数受信するという現象が起こる。この原因は、例えば、サーバの送信でquitを送り、クライアントの受信でquitを受け取った際、それぞれの親プロセスが子プロセスをkillするまでに、クライアントの送信がサーバの受信に対して何らかの誤作動を起こしてしまうためだと考える。よって、quitを送信または受信した際に、子プロセスを同時に終了させる必要があるのではないかと思う。
